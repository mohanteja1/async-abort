!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("AsyncAbort",[],e):"object"==typeof exports?exports.AsyncAbort=e():t.AsyncAbort=e()}(this,(function(){return(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>i});var n=new(function(){function t(){this.listeners=new Map}return t.prototype.add=function(t,e){this.listeners.has(t)||this.listeners.set(t,e)},t.prototype.remove=function(t){this.listeners.delete(t)},t.prototype.emit=function(t,e){var n;this.listeners.has(t)&&(null===(n=this.listeners.get(t))||void 0===n||n(e))},t}());const i=function(){function t(t,e){void 0===e&&(e=[]),this.id=((t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let i=63&n[t];e+=i<36?i.toString(36):i<62?(i-26).toString(36).toUpperCase():i<63?"_":"-"}return e})(7),this.asyncFun=t,this.asyncFunParams=e}return t.prototype.then=function(t){return this.thenBlock=t,this},t.prototype.catch=function(t){return this.catchBlock=t,this},t.prototype.finally=function(t){return this.finallyBlock=t,this},t.prototype.call=function(){var t=this;if(this.asyncFun)return n.add(this.id,(function(e){var n=e.type,i=e.value;switch(n){case"then":t.thenBlock&&t.thenBlock(i);break;case"catch":t.catchBlock&&t.catchBlock(i);break;case"finally":t.finallyBlock&&t.finallyBlock(i)}})),this.asyncFun.apply(this,this.asyncFunParams).then((function(e){n.emit(t.id,{type:"then",value:e})})).catch((function(e){n.emit(t.id,{type:"catch",value:e})})).finally((function(){n.emit(t.id,{type:"finally"}),n.remove(t.id)})),function(){n.remove(t.id)}},t}();return e.default})()}));