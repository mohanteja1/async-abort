!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("AsyncAbort",[],n):"object"==typeof exports?exports.AsyncAbort=n():t.AsyncAbort=n()}(this,(function(){return(()=>{"use strict";var t={d:(n,e)=>{for(var i in e)t.o(e,i)&&!t.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:e[i]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n)},n={};t.d(n,{default:()=>i});var e=new(function(){function t(){this.cbs=new Map,this.count=0}return t.prototype.add=function(t,n){this.cbs.has(t)||this.cbs.set(t,n)},t.prototype.remove=function(t){this.cbs.delete(t)},t.prototype.emit=function(t,n){var e;return null===(e=this.cbs.get(t))||void 0===e?void 0:e(n)},t}());const i=function(){function t(t,n){void 0===n&&(n=[]),this.id=Date.now()+"_"+ ++e.count,this.func=t,this.args=n,this.chain=[]}return t.prototype.then=function(t){return this.chain.push({type:"then",cb:t}),this},t.prototype.catch=function(t){return this.chain.push({type:"catch",cb:t}),this},t.prototype.finally=function(t){return this.chain.push({type:"finally",cb:t}),this},t.prototype.clearRefs=function(){this.func=this.args=this.chain=void 0},t.prototype.call=function(){var t=this;this.chain.push({type:"finally",cb:function(){return e.remove(t.id)}}),e.add(this.id,(function(n){var e=n.index,i=n.value;return t.chain[e].cb(i)}));var n=this.func.apply(this,this.args);return this.chain.forEach((function(i,o){switch(i.type){case"then":n=n.then((function(n){return e.emit(t.id,{index:o,value:n})}));break;case"catch":n=n.catch((function(n){return e.emit(t.id,{index:o,value:n})}));break;case"finally":n=n.finally((function(){return e.emit(t.id,{index:o})}))}})),function(){e.remove(t.id),t.clearRefs()}},t}();return n.default})()}));