!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("AsyncAbort",[],e):"object"==typeof exports?exports.AsyncAbort=e():t.AsyncAbort=e()}(this,(function(){return(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>i});var n=new(function(){function t(){this.listeners=new Map}return t.prototype.add=function(t,e){this.listeners.has(t)||this.listeners.set(t,e)},t.prototype.remove=function(t){this.listeners.delete(t)},t.prototype.emit=function(t,e){var n;return null===(n=this.listeners.get(t))||void 0===n?void 0:n(e)},t}());const i=function(){function t(t,e){void 0===e&&(e=[]),this.id=((t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let i=63&n[t];e+=i<36?i.toString(36):i<62?(i-26).toString(36).toUpperCase():i<63?"_":"-"}return e})(7),this.asyncFun=t,this.asyncFunParams=e,this.chain=[]}return t.prototype.then=function(t){return this.chain.push({type:"then",callback:t}),this},t.prototype.catch=function(t){return this.chain.push({type:"catch",callback:t}),this},t.prototype.finally=function(t){return this.chain.push({type:"finally",callback:t}),this},t.prototype.clearReferences=function(){this.asyncFun=void 0,this.asyncFunParams=void 0,this.chain=void 0},t.prototype.call=function(){var t=this;this.chain.push({type:"finally",callback:function(){return n.remove(t.id)}}),n.add(this.id,(function(e){var n=e.index,i=e.value;return t.chain[n].callback(i)}));var e=this.asyncFun.apply(this,this.asyncFunParams);return this.chain.forEach((function(i,r){switch(i.type){case"then":e=e.then((function(e){return n.emit(t.id,{index:r,value:e})}));case"catch":e=e.catch((function(e){return n.emit(t.id,{index:r,value:e})}));case"finally":e=e.finally((function(){return n.emit(t.id,{index:r})}))}})),function(){n.remove(t.id),t.clearReferences()}},t}();return e.default})()}));