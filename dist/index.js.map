{"version":3,"file":"index.js","mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,aAAc,GAAIH,GACC,iBAAZC,QACdA,QAAoB,WAAID,IAExBD,EAAiB,WAAIC,IARvB,CASGK,MAAM,WACT,M,mBCTA,IAAIC,EAAsB,CCA1BA,EAAwB,CAACL,EAASM,KACjC,IAAI,IAAIC,KAAOD,EACXD,EAAoBG,EAAEF,EAAYC,KAASF,EAAoBG,EAAER,EAASO,IAC5EE,OAAOC,eAAeV,EAASO,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3EF,EAAwB,CAACQ,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,I,4BCGlF,IAqBMI,EAAkB,IArBxB,WAGI,aACId,KAAKe,IAAM,IAAIC,IACfhB,KAAKiB,MAAQ,EAcrB,OAXI,YAAAC,IAAA,SAAIC,EAAYC,GACVpB,KAAKe,IAAIM,IAAIF,IAAKnB,KAAKe,IAAIO,IAAIH,EAAIC,IAGzC,YAAAG,OAAA,SAAOJ,GACLnB,KAAKe,IAAIS,OAAOL,IAGlB,YAAAM,KAAA,SAAKN,EAAYO,G,MACf,OAAuB,QAAhB,EAAA1B,KAAKe,IAAIP,IAAIW,UAAG,eAAGO,IAEhC,EAnBA,IAwEA,QAlDA,WAME,WAAYC,EAAqBC,QAAA,IAAAA,IAAAA,EAAA,IAC/B5B,KAAKmB,GAAQU,KAAKC,MAAK,OAAMhB,EAAgBG,MAC7CjB,KAAK2B,KAAOA,EACZ3B,KAAK4B,KAAOA,EACZ5B,KAAK+B,MAAQ,GAsCjB,OAnCE,YAAAC,KAAA,SAAKZ,GAEH,OADApB,KAAK+B,MAAME,KAAK,CAAEC,KAAM,OAAQd,GAAE,IAC3BpB,MAGT,YAAAmC,MAAA,SAAMf,GAEJ,OADApB,KAAK+B,MAAME,KAAK,CAAEC,KAAM,QAASd,GAAE,IAC5BpB,MAGT,YAAAoC,QAAA,SAAQhB,GAEN,OADApB,KAAK+B,MAAME,KAAK,CAAEC,KAAM,UAAWd,GAAE,IAC9BpB,MAGT,YAAAa,KAAA,sBACEb,KAAK+B,MAAME,KAAK,CAAEC,KAAM,UAAWd,GAAI,WAAM,OAAAN,EAAgBS,OAAO,EAAvB,OAC7CT,EAAgBI,IAAIlB,KAAKmB,IAAI,SAAC,G,IAAEkB,EAAK,QAAEC,EAAK,QAAuC,SAAKP,MAAMM,GAAOjB,GAAGkB,MACxG,IAAMnB,EAAKnB,KAAKmB,GACZoB,EAAUvC,KAAK2B,KAAI,MAAT3B,KAAaA,KAAK4B,MAchC,OAbA5B,KAAK+B,MAAMS,SAAQ,SAAC,EAAUH,GAC5B,OADwB,QAEtB,IAAK,OACHE,EAAUA,EAAQP,MAAK,SAACM,GAAU,OAAAxB,EAAgBW,KAAK,EAAKN,GAAI,CAAEkB,MAAK,EAAEC,MAAvC,OAClC,MACF,IAAK,QACHC,EAAUA,EAAQJ,OAAM,SAACM,GAAU,OAAA3B,EAAgBW,KAAK,EAAKN,GAAI,CAAEkB,MAAK,EAAEC,MAAvC,OACnC,MACF,IAAK,UACHC,EAAUA,EAAQH,SAAQ,WAAM,OAAAtB,EAAgBW,KAAK,EAAKN,GAAI,CAAEkB,MAAhC,WAI/B,WAAM,OAAAvB,EAAgBS,OAAhB,KAEjB,EAhDA,G","sources":["webpack://AsyncAbort/webpack/universalModuleDefinition","webpack://AsyncAbort/webpack/bootstrap","webpack://AsyncAbort/webpack/runtime/define property getters","webpack://AsyncAbort/webpack/runtime/hasOwnProperty shorthand","webpack://AsyncAbort/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"AsyncAbort\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"AsyncAbort\"] = factory();\n\telse\n\t\troot[\"AsyncAbort\"] = factory();\n})(this, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","type Callback = (...args: any[]) => any;\ntype AsyncFunction = (...args: any[]) => Promise<any>;\n\nclass Observer {\n    cbs: Map<string, Callback>;\n    count: number;\n    constructor() {\n        this.cbs = new Map();\n        this.count = 0;\n    }\n\n    add(id: string, cb: Callback) {\n      if(!this.cbs.has(id)) this.cbs.set(id, cb);\n    }\n\n    remove(id: string) {\n      this.cbs.delete(id);\n    }\n\n    emit(id: string, event: any) {\n      return this.cbs.get(id)?.(event);\n    }\n}\n\nconst PromiseObserver = new Observer();\nclass AsyncAbort {\n  private id: string;\n  private func: AsyncFunction;\n  private args: Array<any>;\n  private chain: Array<{ type: 'then' | 'catch' | 'finally', cb: Callback }>;\n\n  constructor(func: AsyncFunction, args: Array<any> = []) {\n    this.id = `${Date.now()}_${++PromiseObserver.count}`;\n    this.func = func;\n    this.args = args;\n    this.chain = [];\n  }\n\n  then(cb: Callback): AsyncAbort {\n    this.chain.push({ type: 'then', cb});\n    return this;\n  }\n\n  catch(cb: Callback): AsyncAbort {\n    this.chain.push({ type: 'catch', cb });\n    return this;\n  }\n\n  finally(cb: Callback): AsyncAbort {\n    this.chain.push({ type: 'finally', cb });\n    return this;\n  }\n\n  call(): Callback {\n    this.chain.push({ type: 'finally', cb: () => PromiseObserver.remove(this.id)});\n    PromiseObserver.add(this.id, ({ index, value } : { value: any, index: number }) => this.chain[index].cb(value));\n    const id = this.id;\n    let promise = this.func(...this.args);\n    this.chain.forEach(({ type }, index) => {\n      switch (type) {\n        case 'then':\n          promise = promise.then((value) => PromiseObserver.emit(this.id, { index, value }));\n          break;\n        case 'catch':\n          promise = promise.catch((error) => PromiseObserver.emit(this.id, { index, value: error }));\n          break;\n        case 'finally':\n          promise = promise.finally(() => PromiseObserver.emit(this.id, { index }));\n          break;\n      }\n    });\n    return () => PromiseObserver.remove(id);\n  }\n}\n\nexport default AsyncAbort;"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","PromiseObserver","cbs","Map","count","add","id","cb","has","set","remove","delete","emit","event","func","args","Date","now","chain","then","push","type","catch","finally","index","value","promise","forEach","error"],"sourceRoot":""}